<form [formGroup]="userForm" (ngSubmit)="save()">
    <span mat-dialog-title>Guardar usuario</span>
    <mat-dialog-content class="mat-typography">
        <div class="mt-2 mb-4 space-y-4">
            <div class="flex gap-x-4">
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Nombres</mat-label>
                    <input matInput type="text" id="firstNames" formControlName="firstNames" required>
                    @if (userForm.controls.firstNames.invalid) {
                    <mat-error>Introduce nombres válidos</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Apellidos</mat-label>
                    <input matInput type="text" id="lastNames" formControlName="lastNames" required>
                    @if (userForm.controls.lastNames.invalid) {
                    <mat-error>Introduce apellidos válidos</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Tipo de documento</mat-label>
                    <mat-select id="typeDocument" formControlName="typeDocument" required>
                        @for (option of typesDocuments(); track option) {
                        <mat-option [value]="option">{{option}}</mat-option>
                        }
                    </mat-select>
                    @if (userForm.controls.typeDocument.invalid) {
                    <mat-error class="truncate">Introduce un tipo de documento válido</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Número de documento</mat-label>
                    <input matInput type="number" id="numberDocument" formControlName="numberDocument" required>
                    @if (userForm.controls.numberDocument.invalid) {
                    <mat-error>Introduce un número de documento válido</mat-error>
                    }
                </mat-form-field>
            </div>
            <div class="flex gap-x-4">
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Correo electrónico</mat-label>
                    <input matInput type="email" id="email" formControlName="email" required>
                    @if (userForm.controls.email.invalid) {
                    <mat-error>Introduce un correo válido</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Dirección</mat-label>
                    <input matInput type="text" id="address" formControlName="address" required>
                    @if (userForm.controls.address.invalid) {
                    <mat-error>Introduce una dirección válida</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Teléfono</mat-label>
                    <input matInput type="number" id="phone" formControlName="phone" required>
                    @if (userForm.controls.phone.invalid) {
                    <mat-error>Introduce un teléfono válido</mat-error>
                    }
                </mat-form-field>
            </div>
            <div class="flex gap-4">
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Fecha de nacimiento</mat-label>
                    <input matInput [matDatepicker]="picker" [max]="maxDate" id="birthday" formControlName="birthday"
                        required>

                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>

                    @if (userForm.controls.birthday.invalid) {
                    <mat-error>Introduce una fecha de nacimiento válida</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Genero</mat-label>
                    <mat-select id="gender" formControlName="gender" required>
                        @for (option of genders(); track option) {
                        <mat-option [value]="option">{{option}}</mat-option>
                        }
                    </mat-select>
                    @if (userForm.controls.gender.invalid) {
                    <mat-error class="truncate">Introduce un genero válido</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Oficia</mat-label>
                    <input matInput type="text" id="office" formControlName="office" required>
                    @if (userForm.controls.office.invalid) {
                    <mat-error>Introduce una oficina válida</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Cargo</mat-label>
                    <input matInput type="text" id="position" formControlName="position" required>
                    @if (userForm.controls.position.invalid) {
                    <mat-error>Introduce un cargo válido</mat-error>
                    }
                </mat-form-field>
            </div>
            <div class="flex gap-4">
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Rol</mat-label>
                    <mat-select id="roles" formControlName="roles" multiple required>
                        @for (role of roles; track $index) {
                        <mat-option [value]="role._id">{{role.name}}</mat-option>
                        }
                    </mat-select>
                    @if (userForm.controls.roles.invalid) {
                    <mat-error>Introduce un rol válido</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Contraseña</mat-label>
                    <input matInput type="password" id="password" formControlName="password" [required]="isNew">
                    @if (userForm.controls.password.invalid) {
                    <mat-error>Introduce una contraseña válida</mat-error>
                    }
                </mat-form-field>

                <mat-slide-toggle formControlName="state" labelPosition="before"
                    class="self-center text-center w-full mb-4">
                    Estado
                </mat-slide-toggle>

                <div class="self-center w-full mb-4">
                    <button type="button" mat-button (click)="fileInput.click()">Elegir firma</button>
                    <input hidden #fileInput (change)="onFileSelected($event)" type="file" id="file" accept="image/*">
                    <span>{{nameFile || 'Sin firma'}}</span>
                </div>
            </div>
        </div>
    </mat-dialog-content>
    <mat-dialog-actions>
        <button mat-stroked-button mat-dialog-close>Cancelar</button>
        <button mat-flat-button cdkFocusInitial type="submit" id="saveUser">Guardar</button>
    </mat-dialog-actions>
</form>