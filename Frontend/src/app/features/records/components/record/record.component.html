<form [formGroup]="recordForm" (ngSubmit)="save()">
    <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-x-2">
            <button mat-icon-button type="button" (click)="goToRecords()"
                matTooltip="Atras"><mat-icon>arrow_back</mat-icon>
            </button>
            <h6 class="mb-0">Guardar Registro - <span>{{format()?.name | titlecase}}</span></h6>
        </div>
        <div class="flex items-center gap-x-2">
            @let recordSelected = recordId();
            <button mat-stroked-button type="submit"
                *appPermission="[permissions.CREATE_RECORDS, permissions.UPDATE_RECORDS]">
                <mat-icon>save</mat-icon> Guardar
            </button>
            @if(recordSelected){
            <button mat-stroked-button class="text-red-600" type="button" (click)="remove(recordSelected)"
                *appPermission="permissions.DELETE_RECORDS">
                <mat-icon>delete</mat-icon> Eliminar
            </button>
            }
        </div>
    </div>
    <mat-divider></mat-divider>
    <div class="my-7">
        <mat-form-field appearance="outline" class="w-full mt-5 hidden">
            <mat-label>Fecha de vigencia</mat-label>
            <input matInput [matDatepicker]="picker" id="dateEffective" formControlName="dateEffective" required>

            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>

            @if (recordForm.controls.dateEffective.invalid) {
            <mat-error>Introduce una fecha de vigencia válida</mat-error>
            }
        </mat-form-field>

        @for (row of recordForm.controls.rows.controls; track row; let rowIndex = $index) {
        @if(row.controls.type.value === rowTypes.SINGLE){
        <div class="flex gap-x-2">
            @for (input of row.controls.fields.controls[0].controls; track input; let columnIndex = $index) {
            <app-record-input class="w-full overflow-x-hidden pt-2" [input]="input"></app-record-input>
            }
        </div>
        }
        @if(row.controls.type.value === rowTypes.AREA){
        @let input = row.controls.fields.controls.controls[0];
        @if(input.controls.type.value=='text'){
        <mat-form-field appearance="outline" class="w-full" [formGroup]="input">
            <mat-label>{{input.controls.name.value}}</mat-label>
            <textarea matInput formControlName="value" [required]="input.controls.required.value"></textarea>
            @if (input.controls.value.invalid) {
            <mat-error class="truncate">Introduce un valor válido</mat-error>
            }
        </mat-form-field>
        }
        }
        @if(row.controls.type.value === rowTypes.TABLE){
        <app-record-table [fields]="row.controls.fields"></app-record-table>
        }
        }
    </div>
</form>